<html>
<head>

<script src="https://www.gstatic.com/firebasejs/5.5.7/firebase.js"></script>
<script>
  // Initialize Firebase
  var config = {
    apiKey: "AIzaSyDDcSx3qqO5V2q3P4yY1-fCHvUif5AAm6E",
    authDomain: "names-23ca3.firebaseapp.com",
    databaseURL: "https://names-23ca3.firebaseio.com",
    projectId: "names-23ca3",
    storageBucket: "",
    messagingSenderId: "527861131913"
  };
  firebase.initializeApp(config);
</script>
<title>Enter Email Addresses</title>
</head>
<body>
<div id="getInfo">
    <table id="nameTable" style="width: 80%; margin: 30px">
        <tr>
            <th style="width:50%">Name</th>
            <th style="width:50%">Dietery Requirement</th>
        </tr>
    </table>
</div>
<h3>All emails: </h3>
    <div id="allEmails">
        
    </div>
<script>
var accountTable;
var tableIds;
var tableList;
var nameRef = firebase.database().ref('data/Trainees');
var accounts = [];
nameRef.on('value', function(snapshot) {
    var x = snapshot.val();
    var accountsNo = Object.keys(x).length;
    accounts = [];
    for (var i = 0; i < accountsNo; i++) {
        var account = {};
        account.id = Object.keys(x)[i];
        account.name = x[Object.keys(x)[i]].name;
        account.email = x[Object.keys(x)[i]].email;
        accounts.push(account);
    }
    createTable();
})

function createTable() {
    accountTable = document.getElementById("nameTable");
    tableIds = []
    tableList = document.getElementsByClassName("AccountTableRow")
    for(var i = 0; i < tableList.length; i++){
        tableIds.push(tableList[i].id);
    }
    addToTable();
}

function addToTable() {
    for (var i = 0; i < accounts.length; i++) {
        if (tableIds.includes(accounts[i].id)){
            var elementfind = document.getElementById(accounts[i].id)
            if(elementfind.getElementsByTagName("td")[0].innerHTML != accounts[i].name) {
                
                elementfind.getElementsByTagName("td")[0].innerHTML = accounts[i].name;
            }
            if(elementfind.getElementsByTagName("td")[1].innerHTML != accounts[i].email) {
                
                elementfind.getElementsByTagName("td")[1].innerHTML = accounts[i].email;
            }
        }
        else {
        var row = document.createElement("tr")
        row.className = "AccountTableRow";
        row.id = accounts[i].id;
        var name = document.createElement("td");
        name.textContent = accounts[i].name;
        var email = document.createElement("td");
        email.textContent = accounts[i].email;


        var deletee = document.createElement("td");
        deletee.style.paddingTop = "0px";
        deletee.style.paddingBottom = "0px";
        var deleteeClick = document.createElement("a");
        deleteeClick.setAttribute("href","#");
        deleteeClick.setAttribute("onclick", "deleteFromDataBase("+"'"+accounts[i].id+"'"+")")
        var deleteeImage = document.createElement("img");
        deleteeImage.setAttribute("src", "delete.png");
        deleteeImage.style.width = "28px";
        
        deleteeClick.appendChild(deleteeImage);
        deletee.appendChild(deleteeClick);
        
        row.appendChild(name);
        row.appendChild(email);
        row.appendChild(deletee);
        
        var emailTop = document.createElement("p");
        emailTop.innerHTML = email.innerHTML + "; ";
        document.getElementById("allEmails").appendChild(emailTop);
        accountTable.appendChild(row);
    }
}
}

function deleteFromTable(id) {
    var element = document.getElementById(id);
    element.parentNode.removeChild(element);
}

function deleteFromDataBase(id) {
    firebase.database().ref('data/Trainees/'+id).remove();
    deleteFromTable(id);
}

</script>
</body>
</html>
